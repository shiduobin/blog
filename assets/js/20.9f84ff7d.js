(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{605:function(t,n,s){"use strict";s.r(n);var a=s(2),e=Object(a.a)({},(function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"什么是-content-length"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是-content-length"}},[t._v("#")]),t._v(" 什么是 Content-Length")]),t._v(" "),s("p",[t._v("Content-Length 用于"),s("strong",[t._v("描述 HTTP 消息实体的传输长度")]),t._v("，用十进制数字表示的八位元组的数目。在 "),s("code",[t._v("HTTP")]),t._v(" 协议中，消息实体长度 (Entity-length) 和消息实体的传输长度是有区别，比如说 "),s("code",[t._v("gzip")]),t._v(" 压缩下，消息实体长度是压缩前的长度，消息实体的传输长度是 "),s("code",[t._v("gzip")]),t._v(" 压缩后的长度。")]),t._v(" "),s("h2",{attrs:{id:"content-length-是如何工作的"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#content-length-是如何工作的"}},[t._v("#")]),t._v(" Content-Length 是如何工作的")]),t._v(" "),s("p",[t._v("Content-Length 采用十进制的数字表示了消息的长度, 服务端/客户端通过它来得知后续要读取消息的长度。")]),t._v(" "),s("h2",{attrs:{id:"content-length-长度不一致引发的问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#content-length-长度不一致引发的问题"}},[t._v("#")]),t._v(" Content-Length 长度不一致引发的问题")]),t._v(" "),s("p",[t._v("1、Content-Length > 实际长度"),s("br"),t._v("\n如果 "),s("code",[t._v("Content-Length")]),t._v(" 比实际的长度大, 服务端/客户端读取到消息结尾后, 会等待下一个字节, 自然会无响应直到超时。")]),t._v(" "),s("p",[t._v("2、Content-Length < 实际长度"),s("br"),t._v("\n如果这个长度小于实际长度, 首次请求的消息会被截取, 比如参数为 "),s("code",[t._v("param=piaoruiqing")]),t._v(", "),s("code",[t._v("Content-Length")]),t._v(" 为 10, 那么这次请求的消息会被截取为: "),s("code",[t._v("param=piao")]),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"不确定-content-length-的长度"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#不确定-content-length-的长度"}},[t._v("#")]),t._v(" 不确定 Content-Length 的长度")]),t._v(" "),s("p",[t._v("对于一些静态的资源我们可以准确知道资源的大小，但对于一些动态的资源比如边传输边下载的资源，我们是无法提前知道资源的大小的，这时我们就需要设置 "),s("code",[t._v("Transfer-Encoding: chunked")]),t._v(" 来替代 "),s("code",[t._v("Content-Length")])]),t._v(" "),s("h2",{attrs:{id:"什么是-transfer-encoding-chunked"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是-transfer-encoding-chunked"}},[t._v("#")]),t._v(" 什么是 Transfer-Encoding: chunked")]),t._v(" "),s("p",[s("code",[t._v("Transfer-Encoding: chunked")]),t._v(" 表示输出的内容长度不能确定，消息体由数量未定的块组成，并以最后一个大小为 0 的块为结束。每一个数据块都包含十六进制的数据长度值和数据，长度值独占一行，长度不包括它结尾的 "),s("code",[t._v("CRLF（\\r\\n）")]),t._v("，也不包括分块数据结尾的 "),s("code",[t._v("CRLF")]),t._v("，最后一个分块长度值必须为 0，对应的分块数据没有内容，表示实体结束。")]),t._v(" "),s("p",[s("strong",[t._v("注意：当设置了 Transfer-Encoding: chunked 时，Content-Length 则会被忽略")])]),t._v(" "),s("h2",{attrs:{id:"content-length-应用场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#content-length-应用场景"}},[t._v("#")]),t._v(" Content-Length 应用场景")]),t._v(" "),s("p",[t._v("通过 Content-Length 我们可以实现简单的文件下载进度条功能，简单的代码实现如下：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" xhr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" downloadUrl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"installer.dmg"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" downloadUrl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"progress"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" onDownloadProgress"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onDownloadProgress")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 通过 event.lengthComputable 可以判断是响应头中是否添加了 Content-Length")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lengthComputable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当前已加载资源字节大小")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" loaded "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loaded"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 总资源大小 Content-Length 的长度")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" total "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("total"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 相关下载动画展示逻辑。。。")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br")])])])}),[],!1,null,null,null);n.default=e.exports}}]);